#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸ” Running pre-commit checks..."

# JSX Error Prevention & Quality Gate
echo "ðŸ”Ž Running JSX validation..."
node scripts/jsx-error-monitor.cjs scan
JSX_EXIT_CODE=$?

if [ $JSX_EXIT_CODE -ne 0 ]; then
  echo "âŒ JSX errors detected. Commit blocked."
  echo "Run 'npm run jsx:report' for details"
  echo "Fix JSX errors with: npm run lint:fix"
  exit 1
fi

# Run lint-staged for staged files
echo "ðŸŽ¨ Running lint-staged..."
npx lint-staged

# Run type checking
echo "ðŸ§ª Running TypeScript type check..."
npm run type-check:full

echo "âœ… Pre-commit checks completed successfully!"
echo "ðŸ“Š Updating build metrics..."
node scripts/build-metrics-dashboard.cjs record-build success 0 pre-commit-validation 2>/dev/null || true
