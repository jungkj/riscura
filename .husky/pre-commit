#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# JSX Error Prevention & Quality Gate
echo "🔎 Running JSX validation..."
node scripts/jsx-error-monitor.cjs scan
JSX_EXIT_CODE=$?

if [ $JSX_EXIT_CODE -ne 0 ]; then
  echo "❌ JSX errors detected. Commit blocked."
  echo "Run 'npm run jsx:report' for details"
  echo "Fix JSX errors with: npm run lint:fix"
  exit 1
fi

# Run lint-staged for staged files
echo "🎨 Running lint-staged..."
npx lint-staged

# Run type checking
echo "🧪 Running TypeScript type check..."
npm run type-check:full

echo "✅ Pre-commit checks completed successfully!"
echo "📊 Updating build metrics..."
node scripts/build-metrics-dashboard.cjs record-build success 0 pre-commit-validation 2>/dev/null || true
